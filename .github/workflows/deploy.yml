name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main # ç¡®ä¿è¿™æ˜¯æ‚¨çš„ä¸»åˆ†æ”¯å

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      - name: Inject Firebase Config ğŸ’‰
        # å°†Secretsä½œä¸ºç¯å¢ƒå˜é‡ä¼ å…¥ï¼Œè¿™æ˜¯æ›´å®‰å…¨ã€æ›´ç¨³å®šçš„åšæ³•
        env:
          FIREBASE_CONFIG: ${{ secrets.FIREBASE_CONFIG }}
          FIREBASE_AUTH_TOKEN: ${{ secrets.FIREBASE_AUTH_TOKEN }}
        run: |
          # æ£€æŸ¥Secretsæ˜¯å¦å·²è®¾ç½®ï¼Œå¦‚æœæœªè®¾ç½®åˆ™æŠ¥é”™é€€å‡º
          if [ -z "$FIREBASE_CONFIG" ]; then
            echo "é”™è¯¯ï¼šFIREBASE_CONFIG secret æœªè®¾ç½®!"
            exit 1
          fi
          
          # å®šä¹‰è¦ä¿®æ”¹çš„HTMLæ–‡ä»¶å
          HTML_FILE="index.html"
          
          # åˆ›å»ºè¦æ³¨å…¥çš„JSä»£ç å—
          # FIREBASE_CONFIGåº”è¯¥æ˜¯åŸå§‹çš„JSONå¯¹è±¡, ä¾‹å¦‚ { "apiKey": "..." }
          # FIREBASE_AUTH_TOKENæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥éœ€è¦å¼•å·
          JS_BLOCK="<script>window.__firebase_config = ${FIREBASE_CONFIG}; window.__initial_auth_token = '${FIREBASE_AUTH_TOKEN}';<\/script>"
          
          # ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶æ¥å¤„ç†æ›¿æ¢ï¼Œä»¥é¿å…ç‰¹æ®Šå­—ç¬¦å¯¼è‡´sedå‘½ä»¤å‡ºé”™
          echo "$JS_BLOCK" > replacement.txt
          
          # æ›¿æ¢å ä½ç¬¦ã€‚è¿™ç§æ–¹æ³•æ¯”ç®€å•çš„å•è¡Œsedå‘½ä»¤æ›´å¯é 
          sed -i.bak -e "//r replacement.txt" -e "//d" $HTML_FILE
          
      - name: Deploy ğŸš€
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./ # å‘å¸ƒæ•´ä¸ªæ ¹ç›®å½•ï¼Œå› ä¸ºindex.htmlå°±åœ¨è¿™é‡Œ
