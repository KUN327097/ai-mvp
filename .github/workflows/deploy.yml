name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main # ç¡®ä¿è¿™æ˜¯æ‚¨çš„ä¸»åˆ†æ”¯å

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      - name: Build and Deploy ğŸš€
        run: |
          # æ‰¾åˆ°HTMLæ–‡ä»¶, å¦‚æœæ‚¨çš„æ–‡ä»¶åä¸æ˜¯index.html, è¯·åœ¨è¿™é‡Œä¿®æ”¹
          html_file="index.html" 

          # è¯»å–Firebaseé…ç½®å’ŒToken Secrets
          firebase_config='${{ secrets.FIREBASE_CONFIG }}'
          auth_token='${{ secrets.FIREBASE_AUTH_TOKEN }}'

          # åˆ›å»ºè¦æ’å…¥çš„è„šæœ¬å—
          js_block="<script> window.__firebase_config = JSON.stringify(${firebase_config}); window.__initial_auth_token = '${auth_token}'; <\/script>"
          
          # ä½¿ç”¨sedå‘½ä»¤æ‰¾åˆ°å ä½ç¬¦å¹¶æ›¿æ¢ä¸ºè„šæœ¬å—
          sed -i.bak "s|<!-- GITHUB_ACTIONS_REPLACEMENT_BLOCK -->|${js_block}|" "$html_file"
          
          # éƒ¨ç½²ç›®å½•å‡†å¤‡
          # æˆ‘ä»¬ç›´æ¥åœ¨æ ¹ç›®å½•æ“ä½œï¼Œå› ä¸ºgh-pages actionå¯ä»¥æŒ‡å®šå‘å¸ƒæ–‡ä»¶
          # å¦‚æœæ‚¨çš„ä»“åº“åªæœ‰ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œå°±ä¸éœ€è¦å¤æ‚çš„ç›®å½•ç§»åŠ¨äº†

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./ # å‘å¸ƒæ•´ä¸ªä»“åº“çš„æ ¹ç›®å½•
          # æ³¨æ„ï¼šæ­¤å¤„çš„è®¾ç½®å‡è®¾æ‚¨çš„ä»“åº“æ ¹ç›®å½•å°±æ˜¯æ‚¨æƒ³å‘å¸ƒçš„ç½‘ç«™å†…å®¹
